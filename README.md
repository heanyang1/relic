# Relic

[![codecov](https://codecov.io/github/heanyang1/relic/graph/badge.svg?token=ZNDVPWBDNG)](https://codecov.io/github/heanyang1/relic)

Relic (Rust-Enabled LIsp Compiler [^note1]) is a minimal, self-contained Lisp system written in Rust.

[^note1]: The name used to be the acronym of Rust-Enabled Lisp Interpreter and Compiler because there was a interpreter that can be run on command line and online (by compiling it to WASM), but I abandoned it for many reasons.

## Features

- It supports a small subset of R5RS that is sufficient to run most programs in [SICP](https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/full-text/book/book.html) with minor modifications
- Lisp code are compiled to C
- It contains a REPL and a debugger that JIT compiles code
- It has a simple package system. You can wrap C code as Relic package (and vice versa)
- It has less than 4k lines of Rust code [^note2]

More features of Scheme will be added as long as the feature does not add too much complexity to the system.

[^note2]: The line count does not contain test code.

## Compile and Run

Relic can only be run on a Unix-like OS that has C toolchain (and Rust, of course).

The REPL, the debugger and the compiler are all in the main executable. Run `cargo run -- --help` to see the usage.

The compiler only compiles Lisp code to C code (unlike GCC or Clang). You need to compile and link the output C code:
```sh
# Lisp -> C
cargo run -- compile program.lisp program.c
# C -> executable
# You need to include `c_runtime/runtime.h` and link `target/debug/librelic.so`
clang -Ic_runtime -o program program.c -Ltarget/debug -lrelic -Wl,-rpath,target/debug
# Run the program
./program
```

See [this README.md](lib/README.md) for how to create and load a package in Relic.

## Testing

Aside from the usual `cargo test`, there is a Python script to test the C code generated by the compiler:
```sh
# Writes C code to `c_runtime/tests`
cargo test
cd c_runtime
# Compile the tests
./run_tests.py
```

## License

MIT OR Apache 2.0
